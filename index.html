<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç™¾å²äººç”Ÿ - Life Grid V1.2 (å«å¤‡ä»½)</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --grid-past: #e0e0e0;     
            --grid-future: #ffffff;   
            --grid-border: #e8e8e8;
            --mood-happy: #f1c40f;    /* äº®é»„è‰² */
            --mood-hard: #7f8c8d;     /* æ²‰ç¨³ç° */
            --text-primary: #2c3e50;
            --accent-color: #3498db;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        /* å¤´éƒ¨ä¸æ§åˆ¶åŒº */
        header { 
            text-align: center; 
            margin-bottom: 30px; 
            position: relative;
        }
        h1 { font-weight: 300; letter-spacing: 3px; color: #34495e; margin-bottom: 5px; }
        .subtitle { font-size: 14px; color: #95a5a6; margin-bottom: 25px; }

        .controls-wrapper {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .config-area {
            display: inline-flex;
            align-items: center;
            background: #f8f9fa;
            padding: 8px 15px;
            border-radius: 50px;
            gap: 10px;
            border: 1px solid #eee;
        }

        .data-btn {
            padding: 8px 15px;
            border-radius: 50px;
            border: 1px solid #eee;
            background: white;
            cursor: pointer;
            font-size: 13px;
            color: #666;
            transition: all 0.2s;
        }
        .data-btn:hover { background: #f0f0f0; color: #333; }

        input[type="date"] {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            color: #555;
            font-family: inherit;
        }

        /* ä»ªè¡¨ç›˜ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #fbfbfb;
            border-radius: 12px;
            border: 1px solid #eee;
        }

        .stat-card { text-align: center; padding: 15px 10px; }
        .stat-value { font-size: 28px; font-weight: 700; color: var(--text-primary); line-height: 1.2; }
        .stat-label { font-size: 12px; color: #95a5a6; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .highlight-clock { color: var(--accent-color); }
        .clock-msg { font-size: 13px; color: #7f8c8d; margin-top: 8px; font-style: italic; min-height: 20px; }

        /* ç½‘æ ¼ */
        .life-grid {
            display: grid;
            grid-template-columns: repeat(52, 1fr); 
            gap: 3px;
            margin-top: 20px;
        }

        .week-box {
            aspect-ratio: 1;
            background-color: var(--grid-future);
            border: 1px solid var(--grid-border);
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .week-box.past { background-color: var(--grid-past); border-color: transparent; }
        .week-box.happy { background-color: var(--mood-happy); }
        .week-box.hard { background-color: var(--mood-hard); }
        
        .week-box:hover { 
            transform: scale(1.8); 
            z-index: 10; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border-color: #666;
        }

        /* å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.4);
            backdrop-filter: blur(2px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        textarea {
            width: 100%; height: 100px;
            margin: 15px 0; padding: 12px;
            border: 1px solid #eee; border-radius: 8px;
            font-family: inherit; resize: none;
            box-sizing: border-box;
        }
        textarea:focus { outline: none; border-color: var(--accent-color); }

        .btn-group { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .btn { padding: 8px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; }
        .btn-primary { background: var(--text-primary); color: white; }
        .btn-cancel { background: #ecf0f1; color: #7f8c8d; }

        /* å›¾ä¾‹ */
        .legend {
            display: flex; gap: 20px; justify-content: center;
            margin-top: 30px; font-size: 12px; color: #95a5a6;
        }
        .dot { width: 10px; height: 10px; display: inline-block; margin-right: 5px; border-radius: 2px; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>LIFE RECORDER</h1>
        <div class="subtitle">æœ‰äº›æ ¼å­æ˜¯ç”¨æ¥å¥”è·‘çš„ï¼Œæœ‰äº›æ˜¯ç”¨æ¥å‘å‘†çš„</div>
        
        <div class="controls-wrapper">
            <div class="config-area">
                <label>ğŸ‚ å‡ºç”Ÿæ—¥æœŸï¼š</label>
                <input type="date" id="dobInput">
            </div>
            <button class="data-btn" onclick="exportData()">ğŸ“¥ å¤‡ä»½æ•°æ® (ä¸‹è½½)</button>
            <button class="data-btn" onclick="triggerImport()">ğŸ“¤ æ¢å¤æ•°æ® (ä¸Šä¼ )</button>
            <input type="file" id="importFile" style="display:none" onchange="importData(this)">
        </div>
    </header>

    <div class="dashboard" id="dashboard" style="display:none;">
        <div class="stat-card">
            <div class="stat-value" id="daysLived">0</div>
            <div class="stat-label">åœ¨è¿™ä¸ªä¸–ç•Œ (å¤©)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="weeksLived">0</div>
            <div class="stat-label">å·²åº¦è¿‡ (å‘¨)</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="sleepHours">0</div>
            <div class="stat-label">å·²ç¡çœ  (å°æ—¶)</div>
        </div>
        <div class="stat-card" style="grid-column: span 1;">
            <div class="stat-value highlight-clock" id="lifeClock">00:00</div>
            <div class="stat-label">äººç”Ÿæ—¶é’Ÿ (24håˆ¶)</div>
            <div class="clock-msg" id="clockMsg">...</div>
        </div>
    </div>
    
    <div class="life-grid" id="gridContainer"></div>

    <div class="legend">
        <span><span class="dot" style="background:var(--mood-happy)"></span>å¼€å¿ƒæ—¶åˆ»</span>
        <span><span class="dot" style="background:var(--mood-hard)"></span>è‰°éš¾æ—¶åˆ»</span>
        <span><span class="dot" style="background:var(--grid-past)"></span>å¹³æ·¡å²æœˆ</span>
        <span><span class="dot" style="border:1px solid #ccc"></span>æœªæ¥</span>
    </div>
</div>

<div class="modal" id="noteModal">
    <div class="modal-content">
        <h3 id="modalTitle" style="margin-top:0; color:#2c3e50;">ç¬¬ X å‘¨</h3>
        <p style="font-size:13px; color:#95a5a6;">è¿™å‘¨è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿç»™è¿™ä¸ªæ ¼å­å¡«ä¸Šé¢œè‰²å§ã€‚</p>
        
        <textarea id="weekNote" placeholder="è®°å½•ï¼šç¬¬ä¸€æ¬¡çœ‹æµ·ã€æ¢äº†æ–°å·¥ä½œã€æˆ–è€…åªæ˜¯å‘äº†ä¸€ä¸‹åˆå‘†..."></textarea>
        
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
            <label style="cursor:pointer;"><input type="radio" name="mood" value="normal" checked> â˜ï¸ å¹³æ·¡</label>
            <label style="cursor:pointer;"><input type="radio" name="mood" value="happy"> â˜€ï¸ å¼€å¿ƒ</label>
            <label style="cursor:pointer;"><input type="radio" name="mood" value="hard"> ğŸŒ§ï¸ è‰°éš¾</label>
        </div>

        <div class="btn-group">
            <button class="btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn btn-primary" onclick="saveWeekData()">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
    const TOTAL_YEARS = 100;
    const WEEKS_PER_YEAR = 52;
    const TOTAL_WEEKS = TOTAL_YEARS * WEEKS_PER_YEAR;

    const dobInput = document.getElementById('dobInput');
    const gridContainer = document.getElementById('gridContainer');
    const modal = document.getElementById('noteModal');
    let currentSelectedWeek = null;

    // --- æ ¸å¿ƒé€»è¾‘ ---

    // è¯»å–æœ¬åœ°å­˜å‚¨
    let lifeData = JSON.parse(localStorage.getItem('lifeData')) || {};

    function init() {
        const savedDob = localStorage.getItem('lifeDob');
        if (savedDob) {
            dobInput.value = savedDob;
            renderLife();
        }
        
        dobInput.addEventListener('change', () => {
            // è‡ªåŠ¨ä¿å­˜å‡ºç”Ÿæ—¥æœŸ
            localStorage.setItem('lifeDob', dobInput.value);
            renderLife();
        });
    }

    function getLifeMessage(hour) {
        if (hour < 6) return "äººç”Ÿè¿˜åœ¨å‡Œæ™¨ï¼Œä¸–ç•Œè¿˜åœ¨æ²‰ç¡ï¼Œæœªæ¥å……æ»¡æ— é™å¯èƒ½ã€‚";
        if (hour < 9) return "æ—©ä¸Šå¥½ï¼è¿™æ˜¯äººç”Ÿæœ€æœ‰æ´»åŠ›çš„æ—©æ™¨ï¼Œå»æ¢ç´¢å§ã€‚";
        if (hour < 12) return "ä¸Šåˆæ—¶å…‰ï¼Œç²¾åŠ›å……æ²›ï¼Œæ˜¯æ·±è€•å’Œç§¯ç´¯çš„é»„é‡‘æœŸã€‚";
        if (hour < 14) return "æ­£åˆè‰³é˜³é«˜ç…§ï¼Œä½ æ­£å¤„äºäººç”Ÿçš„å…‰è¾‰æ—¶åˆ»ã€‚";
        if (hour < 18) return "ä¸‹åˆèŒ¶æ—¶é—´ï¼Œæˆç†Ÿè€Œä»å®¹ï¼Œäº«å—æ”¶è·çš„å­£èŠ‚ã€‚";
        if (hour < 22) return "å‚æ™šçš„å¤•é˜³æœ€ç¾ï¼Œæ™ºæ…§å’Œå®‰å®æ˜¯æ­¤åˆ»çš„ç¤¼ç‰©ã€‚";
        return "æ·±å¤œé™è°§ï¼Œå›æœ›æ¥è·¯ï¼Œç¹æ˜Ÿç‚¹ç‚¹çš†æ˜¯æ•…äº‹ã€‚";
    }

    function renderLife() {
        const dob = new Date(dobInput.value);
        if (isNaN(dob.getTime())) return;

        const now = new Date();
        const diffTime = now - dob;
        const daysLived = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        const weeksLived = Math.floor(daysLived / 7);
        
        document.getElementById('dashboard').style.display = 'grid';
        document.getElementById('daysLived').innerText = daysLived.toLocaleString();
        document.getElementById('weeksLived').innerText = weeksLived.toLocaleString();
        document.getElementById('sleepHours').innerText = (daysLived * 8).toLocaleString();

        const lifePercentage = daysLived / (TOTAL_YEARS * 365.25);
        const totalMinutesInDay = 24 * 60;
        const currentLifeMinutes = totalMinutesInDay * lifePercentage;
        const clockHour = Math.floor(currentLifeMinutes / 60);
        const clockMinute = Math.floor(currentLifeMinutes % 60);
        
        const timeStr = `${String(clockHour).padStart(2, '0')}:${String(clockMinute).padStart(2, '0')}`;
        document.getElementById('lifeClock').innerText = timeStr;
        document.getElementById('clockMsg').innerText = getLifeMessage(clockHour);

        gridContainer.innerHTML = '';
        for (let i = 0; i < TOTAL_WEEKS; i++) {
            const div = document.createElement('div');
            div.classList.add('week-box');
            
            if (i < weeksLived) {
                div.classList.add('past');
                if (lifeData[i]) {
                    if (lifeData[i].mood === 'happy') div.classList.add('happy');
                    if (lifeData[i].mood === 'hard') div.classList.add('hard');
                    div.title = lifeData[i].note || 'æ— è®°å½•';
                }
            }
            
            div.onclick = () => openModal(i);
            gridContainer.appendChild(div);
        }
    }

    function openModal(weekIndex) {
        currentSelectedWeek = weekIndex;
        const year = Math.floor(weekIndex / 52);
        const week = (weekIndex % 52) + 1;
        
        document.getElementById('modalTitle').innerText = `${year}å² Â· ç¬¬ ${week} å‘¨`;
        
        const data = lifeData[weekIndex] || { note: '', mood: 'normal' };
        document.getElementById('weekNote').value = data.note;
        
        const radios = document.getElementsByName('mood');
        for (let r of radios) {
            r.checked = (r.value === data.mood);
        }
        
        modal.style.display = 'flex';
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    function saveWeekData() {
        const note = document.getElementById('weekNote').value;
        const radios = document.getElementsByName('mood');
        let mood = 'normal';
        for (let r of radios) {
            if (r.checked) mood = r.value;
        }

        // ä¿å­˜åˆ°å†…å­˜
        lifeData[currentSelectedWeek] = { note, mood };
        // è‡ªåŠ¨ä¿å­˜åˆ° LocalStorage
        localStorage.setItem('lifeData', JSON.stringify(lifeData));
        
        closeModal();
        renderLife();
    }

    // --- å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½ ---

    // 1. å¯¼å‡ºæ•°æ® (ä¸‹è½½JSON)
    function exportData() {
        const dob = localStorage.getItem('lifeDob');
        if (!dob) {
            alert('è¯·å…ˆè®¾ç½®å‡ºç”Ÿæ—¥æœŸå†å¤‡ä»½å“¦ï¼');
            return;
        }

        const exportObj = {
            version: "1.0",
            dob: dob,
            records: lifeData,
            exportDate: new Date().toISOString()
        };

        const dataStr = JSON.stringify(exportObj, null, 2);
        const blob = new Blob([dataStr], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `my_life_backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // 2. è§¦å‘ä¸Šä¼ æ–‡ä»¶
    function triggerImport() {
        document.getElementById('importFile').click();
    }

    // 3. è¯»å–å¹¶æ¢å¤æ•°æ®
    function importData(inputElement) {
        const file = inputElement.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                
                // ç®€å•çš„æ ¡éªŒ
                if (!data.dob && !data.records) {
                    throw new Error("æ ¼å¼ä¸å¯¹");
                }

                if (confirm('ç¡®å®šè¦å¯¼å…¥è¿™ä»½æ•°æ®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰çš„è®°å½•ã€‚')) {
                    if(data.dob) localStorage.setItem('lifeDob', data.dob);
                    if(data.records) {
                        lifeData = data.records;
                        localStorage.setItem('lifeData', JSON.stringify(lifeData));
                    }
                    alert('æ•°æ®æ¢å¤æˆåŠŸï¼é¡µé¢å°†åˆ·æ–°ã€‚');
                    location.reload();
                }
            } catch (err) {
                alert('æ¢å¤å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼çœ‹èµ·æ¥ä¸å¯¹ï¼Œè¯·ç¡®ä¿ä¸Šä¼ çš„æ˜¯å¤‡ä»½å‡ºçš„JSONæ–‡ä»¶ã€‚');
            }
        };
        reader.readAsText(file);
        // æ¸…ç©ºinputï¼Œé˜²æ­¢åŒåæ–‡ä»¶æ— æ³•å†æ¬¡è§¦å‘change
        inputElement.value = '';
    }

    window.onclick = function(event) {
        if (event.target == modal) closeModal();
    }

    init();
</script>

</body>
</html>